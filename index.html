<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#262637">
  <link rel="icon" type="image/x-icon" href="img/icon.png">
  <title>pixel8</title>
</head>

<body res="128"></body>

<script src="js/pixel8.js"></script>
<script>
pixel8.input = "col=x|y;";
pixel8.encode = (x) => {
  var y="";
  x=x.split("");
  var l=Math.round(x.length/2);
  for (i=0;i<l;i++) y+=String.fromCharCode((x[i*2].charCodeAt(0)+(x[i*2+1]||String.fromCharCode(0)).charCodeAt(0)*256)+65536);
  return y;
}
pixel8.decode = (x) => {
  let y="";
  x=x.split("");
  for (i=0;i<x.length;i++) y+=String.fromCharCode((x[i].charCodeAt(0))%256-65536)+String.fromCharCode(Math.round((x[i].charCodeAt(0))/256)-65536);
  return y;
}
const url_string = window.location.href;
const url = new URL(url_string);
const cart = url.searchParams.get("cart");
if (cart!=undefined) {
  var cartD = pixel8.decode(cart);
  pixel8.input = cartD;
}
let t=0;
const scale = 4;
let sr=0;
const w=pixel8.res/scale;
const c=w/2-.5;
const n=256/w;
let vec=[];
function update() {
  console.clear();
  requestAnimationFrame(update);
  cls();
  i=0;
  while (i<w) {
    j=0;
    while (j<w) {
      x=i,y=j;sx=i;sy=j;sz=1;
      col=2;
      eval(pixel8.input);
      vec[x+y*w] = {x:sx,y:sy,z:sz,c:col};
      j++;
    }
    i++;
  }
  vec.sort((v1,v2) => {
    return v2.z - v1.z;
  });
  l=vec.length;
  i=0;
  while(i<l) {
    [sx,sy,sz,col]=[vec[i].x,vec[i].y,vec[i].z,vec[i].c];
    if (sz>0) {
      sx=Math.round(sx*scale);
      sy=Math.round(sy*scale);
      if (isNaN(col)) {
        col1=eval("pixel8.xyzn"+col);
        pixs(sx,sy,col1.x,col1.y,col1.z,2,scale);
      }
      else {
        pixel8.ctx.fillStyle = ((pixel8.palette[Math.round(col||2)%pixel8.palette.length])||col);
        pixel8.ctx.fillRect(sx,sy,scale+sr,scale+sr);
      }
    }
    i++;
  }
  t++;
}
update();
</script>

</html>
